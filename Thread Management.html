<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ThreadMaster – Work-Stealing Thread Pool Simulation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'JetBrains Mono', monospace; background: #0a0e17; color: #e0f2fe; }
    .glow { text-shadow: 0 0 20px rgba(70, 138, 247, 0.8); }
    .cyber-grid {
      background-image: 
        linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    .task {
      position: relative;
      background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
      color: #ffffff;
      font-weight: 700;
      padding: 0.1rem .25rem;
      border-radius: 9999px;
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(59,130,246,0.4);
      transform: translateZ(0);
      font-size: 0.875rem;
      display: inline-block;
    }

    .worker {
      position: relative;
      background: linear-gradient(to bottom, #0f172a, #000000);
      border-radius: 1rem;
      padding: 1.5rem;
      overflow: hidden;
      border: 2px solid hsl(190, 26%, 48%);
      box-shadow: 0 0 30px rgba(3, 6, 6, 0.4);
    }
    .worker::before {
      content: '';
      position: absolute;
      top: 0; right: 0; bottom: 0; left: 0;
      opacity: 0.3;
      background: radial-gradient(circle at center, rgba(72, 116, 123, 0.6) 0%, transparent 70%);
      animation: pulseGlow 1s infinite;
      pointer-events: none;
    }

    .local-queue {
      background: rgba(0, 0, 0, 0.6);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1rem;
      min-height: 8rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
    }
    .current-task {
      min-height: 6rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-weight: 700;
      color: #06a9c6;
    }
    @keyframes pulseGlow { 0%,100% { opacity: 0.3; } 50% { opacity: 0.6; } }
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #00ffea;
      border-radius: 50%;
      pointer-events: none;
      box-shadow: 0 0 10px #00ffea;
    }
  </style>
</head>
<body class="min-h-screen cyber-grid">

  <section class="pt-32 pb-20 px-6">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-6xl md:text-8xl font-black text-center mb-4 glow" style="font-family: 'Orbitron', sans-serif;">
        Thread Management System
      </h1>
      <p class="text-xl md:text-2xl text-center text-cyan-300 mb-16">Visualizing Work-Stealing Thread Pools in Modern Multi-Core CPUs</p>

      <!-- Controls -->
      <div class="flex justify-center gap-6 mb-12 flex-wrap">
        <button id="startBtn" class="px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full font-bold text-lg shadow-2xl hover:scale-110 transition">
          Start 
        </button>
        <button id="burstBtn" class="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full font-bold text-lg shadow-2xl hover:scale-110 transition">
          Add 20 Tasks 
        </button>
        <button id="resetBtn" class="px-8 py-4 bg-gradient-to-r from-red-600 to-rose-700 rounded-full font-bold text-lg shadow-2xl hover:scale-110 transition">
          Reset
        </button>
      </div>

      <!-- Workers -->
      <h2 class="text-3xl font-bold text-cyan-400 mb-8 text-center glow">Logical Processors (Threads) in an Intel Core i7-14700K (20 Physical Cores → 28 Threads)</h2>
      <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-6 max-w-full mx-auto px-4 overflow-x-auto">
        <!-- 28 workers (cores/threads) -->
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-01</div><div id="queue1" class="local-queue"></div><div id="worker1" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-02</div><div id="queue2" class="local-queue"></div><div id="worker2" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-03</div><div id="queue3" class="local-queue"></div><div id="worker3" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-04</div><div id="queue4" class="local-queue"></div><div id="worker4" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-05</div><div id="queue5" class="local-queue"></div><div id="worker5" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-06</div><div id="queue6" class="local-queue"></div><div id="worker6" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-07</div><div id="queue7" class="local-queue"></div><div id="worker7" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-08</div><div id="queue8" class="local-queue"></div><div id="worker8" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-09</div><div id="queue9" class="local-queue"></div><div id="worker9" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-10</div><div id="queue10" class="local-queue"></div><div id="worker10" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-11</div><div id="queue11" class="local-queue"></div><div id="worker11" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-12</div><div id="queue12" class="local-queue"></div><div id="worker12" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-13</div><div id="queue13" class="local-queue"></div><div id="worker13" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-14</div><div id="queue14" class="local-queue"></div><div id="worker14" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-15</div><div id="queue15" class="local-queue"></div><div id="worker15" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-16</div><div id="queue16" class="local-queue"></div><div id="worker16" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-17</div><div id="queue17" class="local-queue"></div><div id="worker17" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-18</div><div id="queue18" class="local-queue"></div><div id="worker18" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-19</div><div id="queue19" class="local-queue"></div><div id="worker19" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-20</div><div id="queue20" class="local-queue"></div><div id="worker20" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-21</div><div id="queue21" class="local-queue"></div><div id="worker21" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-22</div><div id="queue22" class="local-queue"></div><div id="worker22" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-23</div><div id="queue23" class="local-queue"></div><div id="worker23" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-24</div><div id="queue24" class="local-queue"></div><div id="worker24" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-25</div><div id="queue25" class="local-queue"></div><div id="worker25" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-26</div><div id="queue26" class="local-queue"></div><div id="worker26" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-27</div><div id="queue27" class="local-queue"></div><div id="worker27" class="current-task">Idle</div></div>
        <div class="worker"><div class="text-cyan-300 font-bold text-center mb-3">THREAD-28</div><div id="queue28" class="local-queue"></div><div id="worker28" class="current-task">Idle</div></div>
      </div>

      <!-- Stats -->
      <div class="mt-16 text-center text-cyan-200">
        <p class="text-2xl">Tasks Completed: <span id="completedCount" class="text-4xl font-bold text-green-400">0</span></p>
      </div>
    </div>
  </section>

  <!-- Professional Explanation -->
  <section class="py-20 px-6 bg-black/40">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-5xl font-bold text-center mb-12 glow" style="font-family: 'Orbitron', sans-serif;">
        Work-Stealing Thread Pools: Efficient Parallel Execution
      </h2>
      <div class="bg-black/60 backdrop-blur-md border border-cyan-800 rounded-2xl p-10 text-lg leading-relaxed space-y-6">
        <p>Modern CPUs, such as the Intel Core i7-14700K (14th Gen), feature a hybrid architecture with 20 physical cores (8 Performance-cores + 12 Efficient-cores) supporting up to 28 threads via Hyper-Threading.</p>
        <p>In parallel computing, thread pools manage a set of worker threads to execute tasks efficiently. A key challenge is load balancing: ensuring all threads remain utilized when task creation is dynamic or uneven.</p>
        <p>The <strong>work-stealing</strong> algorithm addresses this:</p>
        <ul class="list-disc space-y-4 ml-8">
          <li>Each worker maintains its own double-ended queue (deque) of tasks.</li>
          <li>Workers push new tasks and pop from the front of their own queue (low contention).</li>
          <li>When a worker's queue is empty, it attempts to "steal" a task from the back of another worker's queue.</li>
          <li>This minimizes synchronization overhead while achieving excellent load balancing and scalability.</li>
        </ul>
        <p>In this simulation:</p>
        <ul class="list-disc space-y-4 ml-8">
          <li>Each "THREAD" represents a logical processor.</li>
          <li>Tasks appear in local queues and move to the executing slot when processed.</li>
          <li>Idle threads steal from busy ones, demonstrating dynamic load distribution.</li>
          <li>Completed tasks trigger visual particle effects.</li>
        </ul>
        <p class="text-xl font-bold text-cyan-300 mt-8">
          Work-stealing powers libraries like Intel TBB, Java Fork/Join, Rust Rayon, and C++ std::execution (P2300).
        </p>
        <p class="text-center text-2xl mt-10">Press the buttons to observe the scheduler in action.</p>
      </div>
    </div>
  </section>

  <script>
    let taskCounter = 0;
    let completed = 0;
    let intervalId = null;
    let pulsingTl = [];

    const numWorkers = 28;
    const workerQueues = [];
    const workerCurrents = [];
    for (let i = 1; i <= numWorkers; i++) {
      workerQueues.push(document.getElementById(`queue${i}`));
      workerCurrents.push(document.getElementById(`worker${i}`));
    }

    function createTask(targetQueue) {
      const task = document.createElement('div');
      task.className = 'task';
      task.textContent = `Task ${++taskCounter}`;
      targetQueue.appendChild(task);

      gsap.fromTo(task, 
        { scale: 0, rotation: -360, opacity: 0 },
        { scale: 1, rotation: 0, opacity: 1, duration: 0.7, ease: "elastic.out(1,0.5)" }
      );
    }

    function spawnParticles(x, y) {
      for(let i = 0; i < 20; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = `${x}px`;
        p.style.top = `${y}px`;
        document.body.appendChild(p);
        gsap.to(p, {
          x: Math.random() * 500 - 250,
          y: Math.random() * 500 - 250,
          opacity: 0,
          scale: 0,
          duration: 1.8,
          ease: "power2.out",
          onComplete: () => p.remove()
        });
      }
    }

    function moveTaskToCurrent(task, workerCurrent, sourceQueue) {
      if (!task || !task.parentElement) return;
      const taskRect = task.getBoundingClientRect();
      const workerRect = workerCurrent.getBoundingClientRect();

      const clone = task.cloneNode(true);
      clone.style.position = 'fixed';
      clone.style.left = `${taskRect.left}px`;
      clone.style.top = `${taskRect.top}px`;
      clone.style.margin = 0;
      clone.style.zIndex = 100;
      document.body.appendChild(clone);

      gsap.to(clone, {
        x: (workerRect.left + workerRect.width/2) - (taskRect.left + taskRect.width/2),
        y: (workerRect.top + workerRect.height/2) - (taskRect.top + taskRect.height/2),
        scale: 1.4,
        duration: 0.8,
        ease: "power2.inOut",
        onComplete: () => {
          clone.remove();
          task.remove();

          workerCurrent.innerHTML = '';
          const executing = document.createElement('div');
          executing.className = 'task opacity-90';
          executing.textContent = task.textContent;
          workerCurrent.appendChild(executing);

          const tl = gsap.to(executing, { scale: 1.2, duration: 0.5, yoyo: true, repeat: -1 });
          pulsingTl.push(tl);

          const execTime = 2000 + Math.random() * 3000;
          setTimeout(() => {
            tl.kill();
            pulsingTl = pulsingTl.filter(t => t !== tl);

            gsap.to(executing, {
              scale: 0,
              opacity: 0,
              rotation: 360,
              duration: 0.8,
              onComplete: () => {
                workerCurrent.innerHTML = 'Idle';
                completed++;
                document.getElementById('completedCount').textContent = completed;
                spawnParticles(workerRect.left + workerRect.width/2, workerRect.top + workerRect.height/2);
              }
            });
          }, execTime);
        }
      });
    }

    function processWorkers() {
      workerQueues.forEach((queue, index) => {
        const current = workerCurrents[index];
        const hasTaskExecuting = current.querySelector('.task');
        if (!hasTaskExecuting) {
          let task = null;
          let sourceQueue = null;

          if (queue.children.length > 0) {
            task = queue.children[0];
            sourceQueue = queue;
          } else {
            const victims = workerQueues.filter((q, i) => i !== index && q.children.length > 0);
            if (victims.length > 0) {
              const victim = victims[Math.floor(Math.random() * victims.length)];
              task = victim.lastElementChild;
              sourceQueue = victim;
            }
          }

          if (task) {
            moveTaskToCurrent(task, current, sourceQueue);
          }
        }
      });
    }

    document.getElementById('startBtn').addEventListener('click', () => {
      if (intervalId) clearInterval(intervalId);
      intervalId = setInterval(processWorkers, 800); // Slightly faster for more workers
    });

    document.getElementById('burstBtn').addEventListener('click', () => {
      for(let i = 0; i < 20; i++) {
        const q = workerQueues[Math.floor(Math.random() * numWorkers)];
        setTimeout(() => createTask(q), i * 100);
      }
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      clearInterval(intervalId);
      intervalId = null;
      
      pulsingTl.forEach(tl => tl.kill());
      pulsingTl = [];

      workerQueues.forEach(q => q.innerHTML = '');
      workerCurrents.forEach(c => c.innerHTML = 'Idle');
      taskCounter = 0;
      completed = 0;
      document.getElementById('completedCount').textContent = '0';
      document.querySelectorAll('.particle').forEach(p => p.remove());
    });

    // Initial tasks
    for(let i = 0; i < 30; i++) {
      const q = workerQueues[Math.floor(Math.random() * numWorkers)];
      setTimeout(() => createTask(q), i * 200);
    }
  </script>
</body>
</html>